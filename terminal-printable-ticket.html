<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/terminal-printable-ticket/ticket-print-styles.html">
<link rel="import" href="templates/base.html">

<dom-module id="terminal-printable-ticket">
  <template>
    <style>
      :host {
        display: block;
        color: black;
        z-index: 1000;
        position: relative;
      }
    </style>
    <div id="stamp" class="ticket-print-view"> </div>

  </template>

  <script>
    (function() {
      'use strict'
      let _meta = Polymer.Base.create('iron-meta', {
        type: 'iris-ticket-stamps'
      });

      let getTemplate = function(name) {
        let model = _meta.byKey(name);
        let template = model.getTemplate();
        return template;
      };

      Polymer({
        is: 'terminal-printable-ticket',
        properties: {
          templateName: {
            type: String,
            value: 'live'
          }
        },
        behaviors: [
          Polymer.Templatizer
        ],
        print(data) {
          data = data || {};
          console.log(getTemplate(this.templateName));
          this.templatize(getTemplate(this.templateName));
          this.clone = this.stamp({
            ticket: data.ticket,
            service: data.service,
            office: data.office
          });

          Polymer.dom(this.$.stamp).innerHTML = "";
          Polymer.dom(this.$.stamp).appendChild(this.clone.root);


          window.print();
          return Promise.resolve(true);
        }

      });
    })();
  </script>
</dom-module>